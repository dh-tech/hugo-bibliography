{{- $data := .citation }}
{{- $authorStr := .authorStr }}

{{- $year := "" }}
{{- with $data.date }}
  {{- $parts := split . "-" }}
  {{- if gt (len $parts) 0 }}
    {{- $year = index $parts 0 }}
  {{- end }}
{{- end }}

{{- $title := $data.title | markdownify | plainify }}
{{- $journal := $data.publicationTitle }}
{{- $volume := $data.volume }}
{{- $issue := $data.issue }}
{{- $pages := $data.pages }}
{{- $doi := $data.DOI }}

{{- if and $title $authorStr }}
  <li class="apa-citation">
    {{ if $authorStr }}<span class="citation-author">{{ $authorStr }}</span>{{ end }}
    {{ if $year }}<span class="citation-year">({{ $year }}).</span>{{ end }}
    {{ if $title }}<span class="citation-title">{{ $title }}</span>.{{ end }}
    {{ if $journal }}<span class="citation-journal"><i>{{ $journal }}</i></span>,{{ end }}
    {{ if $volume }}<span class="citation-volume"><i>{{ $volume }}</i></span>{{ end }}
    {{ if $issue }}<span class="citation-issue">({{ $issue }})</span>,{{ end }}
    {{ if $pages }}<span class="citation-pages">{{ $pages }}</span>.{{ end }}
    {{ if $doi }}<a class="citation-doi" href="https://doi.org/{{ $doi }}">https://doi.org/{{ $doi }}</a>{{ end }}
    <span class="Z3988" title="ctx_ver=Z39.88-2004&rft_val_fmt=info:ofi/fmt:kev:mtx:journal&rft.atitle={{ urlquery $title }}&rft.jtitle={{ urlquery $journal }}&rft.date={{ $year }}&rft.au={{ urlquery $authorStr }}&rft.volume={{ $volume }}&rft.issue={{ $issue }}&rft.spage={{ index (split $pages "-") 0 }}&rft.epage={{ index (split $pages "-") 1 }}&rft_id=info:doi/{{ $doi }}">
    </span>
  </li>
{{- end }}