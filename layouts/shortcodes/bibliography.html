<style>
    .apa-citation {
        margin-bottom: 1rem;
        text-indent: -2rem;
        padding-left: 2rem;
    }
</style>

{{- $entries := slice -}}

{{- range site.Data.bibliography }}
{{- if eq .itemType "journalArticle" }}
{{- $authors := slice -}}
{{- range .creators }}
{{- if eq .creatorType "author" }}
{{- $firstInitial := "" -}}
{{- if .firstName }}
{{- $firstInitial = print (substr .firstName 0 1) "." }}
{{- end }}
{{- if .lastName }}
{{- $name := printf "%s, %s" .lastName $firstInitial }}
{{- $authors = $authors | append $name }}
{{- end }}
{{- end }}
{{- end }}
{{- $authorStr := delimit $authors ", " -}}
{{- $entry := dict "authorStr" $authorStr "entry" . -}}
{{- $entries = $entries | append $entry }}
{{- end }}
{{- end }}

{{- $sortedEntries := sort $entries "authorStr" -}}

{{- range $sortedEntries }}
{{- $data := .entry }}
{{- $authorStr := .authorStr }}

{{- $year := "" -}}
{{- with $data.date }}
{{- $splitDate := split . "-" }}
{{- if gt (len $splitDate) 0 }}
{{- $year = index $splitDate 0 }}
{{- end }}
{{- end }}

{{- $title := $data.title | markdownify | plainify }}
{{- $journal := $data.publicationTitle }}
{{- $volume := $data.volume }}
{{- $issue := $data.issue }}
{{- $pages := $data.pages }}
{{- $doi := $data.DOI }}

{{- $citation := printf "%s (%s). %s. <i>%s</i>, <i>%s</i>(%s), %s. https://doi.org/%s" $authorStr $year $title $journal
$volume $issue $pages $doi }}

<p class="apa-citation">{{ $citation | safeHTML }}</p>
{{- end }}